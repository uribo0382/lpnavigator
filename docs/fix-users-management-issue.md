# ユーザー管理画面の問題解決ガイド

## 問題の概要
ユーザー管理画面（`/#/admin/users`）で、データベースに複数のユーザーが存在するにもかかわらず、管理者ユーザーのみが表示される問題が発生しています。

## 原因
1. **Row Level Security (RLS)** - Supabaseのusersテーブルで有効になっているRLSが、適切なポリシーなしにデータアクセスを制限している可能性があります。
2. **データ型の不一致** - `is_active`フィールドがテキスト型で保存されている可能性があります。

## 解決手順

### ステップ1: デバッグ情報の確認
1. アプリケーションを起動し、管理者としてログインします
2. ブラウザのデベロッパーツール（F12）を開き、Consoleタブを確認します
3. `/#/admin/users`にアクセスし、コンソールに出力されるデバッグ情報を確認します

### ステップ2: テストページでの確認（オプション）
1. `/#/admin/test-users`にアクセスします（新しく追加したテストページ）
2. 実際のデータベースからの生データを確認できます

### ステップ3: Supabaseでの修正
1. [Supabaseダッシュボード](https://supabase.com/dashboard)にログインします
2. プロジェクトを選択し、SQL Editorに移動します
3. 以下のSQLファイルの内容を実行します：

```sql
-- database/fix-users-rls-complete.sql の内容をコピーして実行
```

このSQLは以下を実行します：
- RLSを無効化
- 適切な権限を付与
- データ型の修正（必要な場合）
- データの確認

### ステップ4: アプリケーションの確認
1. ブラウザをリフレッシュします
2. `/#/admin/users`に再度アクセスします
3. すべてのユーザーが表示されることを確認します

## デバッグ出力の見方
コンソールには以下のような情報が表示されます：

```
=== getAllUsers START ===
Fetching all users from Supabase...
Query response status: 200
Users count: 3
User roles: [
  { email: "admin@example.com", role: "admin" },
  { email: "bonmo127@gmail.com", role: "user" },
  { email: "boar.it.design@gmail.com", role: "user" }
]
=== getAllUsers END ===
```

## トラブルシューティング

### 問題: まだ管理者ユーザーしか表示されない
1. Supabaseダッシュボードで直接テーブルデータを確認
2. RLSが確実に無効化されているか確認
3. ブラウザのキャッシュをクリアしてリロード

### 問題: エラーが表示される
エラーメッセージに応じて：
- `row-level security` エラー: RLSの無効化が必要
- `permission denied`: 権限の付与が必要

## 今後の推奨事項
1. 本番環境では適切なRLSポリシーを設定してください
2. ユーザーデータへのアクセスは認証されたユーザーのみに制限すべきです
3. 管理者のみがすべてのユーザーを閲覧できるようにポリシーを設定します